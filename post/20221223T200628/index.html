<!DOCTYPE html>
<html>
<head>
<title>Emacs gnus emacs 的邮件系统，以 outlook 邮箱为例 - 手指骑士的病房</title>
<link rel="icon" href="/static/favicon.ico"><link href= "/static/style/style.css" rel="stylesheet" type="text/css" /></head>
<body>
<div class="header">
<div class="home-page">
<a href="/">手指骑士的病房</a></div><div class="nav">
<div class="nav item">
<a href="/tags">标签</a>
</div>
<div class="nav item">
<a href="/archive">归档</a>
</div>
<div class="nav item">
<a href="/about">关于</a>
</div>
<div class="nav item">
<a href="/emacs">Emacs</a>
</div>
</div>
</div>
<div class="main">
<div id="preamble" class="status">
<link rel="stylesheet" href="/static/pygments/dracula.css"><div class="toc">
<h2 class="toc-title"> TOC </h2>
<nav id="TableOfContents">

<ul>
<li>
<a href="#orgf5ec655"> 简介 </a></li>
<li>
<a href="#org2891fec"> 配置 </a>
<ul>
<li>
<a href="#org7d891a9"> 基本配置 </a></li>
<li>
<a href="#org61d2830"> 邮箱配置 </a>
<ul>
<li>
<a href="#orgcf5c999"> 收件服务器配置 </a></li>
<li>
<a href="#org2c15bab"> 发件服务器配置 </a></li>
<li>
<a href="#org79b4755"> 身份验证配置 </a></li>
<li>
<a href="#orgcd126ac"> 使用 </a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#orgb51f6be"> GNUS 结构 </a></li>
<li>
<a href="#org75716e0"> Group </a>
<ul>
<li>
<a href="#org0a7baab"> 组操作 </a>
<ul>
<li>
<a href="#org7be7768"> 组订阅 </a></li>
<li>
<a href="#orge9bf0a8"> 组光标移动 </a></li>
<li>
<a href="#orgf316883"> 组打开退出 </a></li>
<li>
<a href="#orgcbe36c9"> 组标记 </a></li>
<li>
<a href="#org71d1de1"> 组管理 </a></li>
<li>
<a href="#orgebe74a7"> 组显示 </a></li>
<li>
<a href="#org94f03c4"> 组排序 </a></li>
<li>
<a href="#org36a1fb2"> 组其他操作 </a></li>
</ul>
</li>
<li>
<a href="#org43f7e3b"> 组参数 </a></li>
<li>
<a href="#orgc7d0ead"> 话题 </a></li>
</ul>
</li>
<li>
<a href="#org8f62147"> Summary Buffer </a>
<ul>
<li>
<a href="#org73b5b42"> 纲要操作 </a>
<ul>
<li>
<a href="#orgb2388ed"> 纲要打开与退出 </a></li>
<li>
<a href="#orgdbd5384"> 纲要光标移动 </a></li>
<li>
<a href="#orgf2a3a1c"> 文章滚动与操作 </a></li>
<li>
<a href="#orgab6aca2"> 文章显示 </a></li>
<li>
<a href="#org2662f23"> 邮件操作 </a></li>
<li>
<a href="#orge97e6ac"> 文章搜索 </a></li>
</ul>
</li>
<li>
<a href="#orgb800371"> 文章发送 </a>
<ul>
<li>
<a href="#orga06b495"> 邮件撰写 </a></li>
<li>
<a href="#orga6c9f75"> 文章回复 </a></li>
<li>
<a href="#org4eff897"> 文章撰写 </a></li>
</ul>
</li>
<li>
<a href="#org1b3bcaf"> 文章标记 </a>
<ul>
<li>
<a href="#org7df1fae"> 文章标记样式 </a></li>
<li>
<a href="#org8281363"> 文章标记操作 </a></li>
</ul>
</li>
<li>
<a href="#org128c85e"> 文章排序 </a></li>
</ul>
</li>
<li>
<a href="#org3e7c85a"> Article Buffer </a></li>
<li>
<a href="#orgaee4763"> 信息发送 </a>
<ul>
<li>
<ul>
<li>
<a href="#orgacd3616"> 定时发送 </a></li>
<li>
<a href="#org284a95c"> 草稿 </a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#org9225996"> RSS </a>
<ul>
<li>
<a href="#org35ae315"> 通过 Feeddd 获取微信公众号 </a></li>
</ul>
</li>
<li>
<a href="#orgae0198a"> 后记 </a></li>
</ul>
</nav>
</div>
<h1 class="post-title"> Emacs gnus emacs 的邮件系统，以 outlook 邮箱为例 </h1>
<div class="post-date">2023-05-27</div>
<div class="taglist"><a href="/tag/emacs"> #emacs </a>
<a href="/tag/gnus"> #gnus </a>
<a href="/tag/rss"> #rss </a>
<a href="/tag/email"> #email </a>
</div>
</div>
<div id="content">

<div id="outline-container-orgf5ec655" class="outline-2">
<h2 id="orgf5ec655">简介</h2>
<div class="outline-text-2" id="text-orgf5ec655">
<p>
GNUS, Gnus Network User Services, 是 Emacs 的一个信息接收应用，支持接收和发送邮件、新闻，也能用于接收 RSS<sup>[<a id="fnr:1.1" class="footref" href="#fn:1">1</a>]</sup>  。我想换掉 <a href="https://vivaldi.com/" target="_blank">Vivaldi</a> 浏览器，转而用一个更加简洁、更加轻量的浏览器 <a href="https://minbrowser.org/" target="_blank">Min</a> -&#x2013;&#x2014; 有一说一，习惯了 Min 之后感觉真的很清爽，虽然 vivaldi 也能在外观和界面上做到，只是它内置的工具太多了。准备集成 Emac, 通过 GNUS 把邮件和 RSS 都搬到上边，这样 vivaldi 对我而言就没啥优势了。
</p>

<p>
GNUS 的文档《<a href="http://www.gnus.org/manual/big-gnus.html" target="_blank">Gnus Manual</a>》，写的非常详细 -&#x2013;&#x2014; 也就是非常复杂，而且它还涉及到各种信息通信的技术。我了解得少，只想要一个简单的配置，没有花时间看，后面空了再慢慢补上。
</p>

<p>
于是我四面八方搜罗资料，参考论坛的前辈的分享，终于让我写出了一个能用的配置： <a href="https://emacs-china.org/t/emacs-send-mail-rmail-and-gnus/11730" target="_blank">Emacs收发邮件完全操作指南: Send-Mail, Rmail and Gnus - Emacs-general - Emacs China</a> 。
</p>

<p>
同时还有陈斌老师的教程： <a href="https://github.com/redguardtoo/mastering-emacs-in-one-year-guide/blob/master/gnus-guide-en.org" target="_blank">mastering-emacs-in-one-year-guide/gnus-guide-en.org at master · redguardtoo/mastering-emacs-in-one-year-guide · GitHub</a>
</p>
</div>
</div>

<div id="outline-container-org2891fec" class="outline-2">
<h2 id="org2891fec">配置</h2>
<div class="outline-text-2" id="text-org2891fec">
<p>
首先说明的是，我目前的 Emacs 版本（28.2）已经内置了 GNUS 模块，直接 <code>requrire</code> 就能用了。
</p>

<p>
根据官方文档， GNUS 有自己的配置文件 <code>~/.gnus.el</code> ，就像 Emacs 的 <code>init.el</code> 一样。
</p>

<p>
目前我的配置已经使用了 setup 的模块化配置，有一些设定好的参数在 <code>.emacs.d/init.el</code> 里面，同时为了保持配置的一贯性，我决定还是把大部分配置写在这里 <sup>[<a id="fnr:2.1" class="footref" href="#fn:2">2</a>]</sup> ；对于一些隐私信息如邮箱名字、 RSS 订阅列表等就写在 GNUS 的 init 中留在本地。
</p>

<p>
以下的配置写在 <code>~/.eamcs.d</code> 或在 <code>/.gnus.el</code> 中都可以。
</p>
</div>

<div id="outline-container-org7d891a9" class="outline-3">
<h3 id="org7d891a9">基本配置</h3>
<div class="outline-text-3" id="text-org7d891a9">
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-init-file</span><span class="w"> </span><span class="s">&quot;~/.gnus.el&quot;</span>
<span class="w">      </span><span class="nv">gnus-home-directory</span><span class="w"> </span><span class="s">&quot;~/.emacs.d/etc/gnus&quot;</span>
<span class="w">      </span><span class="nv">gnus-use-cache</span><span class="p">)</span>
 </pre>
</div>
<ul class="org-ul">
<li>首先要告诉 GNUS, 它的初始化文件在哪里</li>
<li>设置 GNUS 的数据和配置的存放目录目录。它默认是家目录，如果不改，后续就会有各种奇怪的目录出现</li>
<li>使用缓存，可以离线查看缓存了的邮件</li>
</ul>
</div>
</div>

<div id="outline-container-org61d2830" class="outline-3">
<h3 id="org61d2830">邮箱配置</h3>
<div class="outline-text-3" id="text-org61d2830">
<p>
前面给的论坛里面的分享是用 QQ 邮箱为例子，我用的是 Outlook, 我就以 Outlook 为例。
</p>

<p>
首先，你需要确定自己的邮箱是支持第三方的。大部分邮箱都支持，但还是有比如 Tutanota 就不支持。
</p>

<p>
然后去找到你用邮箱的配置，一般在搜索引擎上就行找到，关键词“xx邮箱 第三方配置”。
</p>


<figure id="org3a8a651">
<a href="/assets/d3bb22947ecd47592526f8977582062b.png" target="_blank" target="_blank"><img src="/assets/d3bb22947ecd47592526f8977582062b.png" alt="d3bb22947ecd47592526f8977582062b.png"></a>

</figure>


<figure id="org38ded87">
<a href="/assets/469331868c67ddf07278524a82dddb7c.png" target="_blank" target="_blank"><img src="/assets/469331868c67ddf07278524a82dddb7c.png" alt="469331868c67ddf07278524a82dddb7c.png"></a>

</figure>

<p>
最好是在官网上看，如果看其他博主分享的话要注意发文时间，因为服务器地址端口可能会更新的。
</p>

<p>
得到如下信息：
</p>
<ul class="org-ul">
<li>收件服务器
<ul class="org-ul">
<li>协议 <code>imap</code></li>
<li>地址  <code>outlook.office365.com</code></li>
<li>端口 <code>993</code></li>
<li>加密方式 <code>ssl</code></li>
</ul></li>
<li>发件服务器
<ul class="org-ul">
<li>协议 <code>smtp</code></li>
<li>地址  <code>osmtp.office365.com</code></li>
<li>端口 <code>587</code></li>
<li>加密方式 <code>startssl</code></li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgcf5c999" class="outline-4">
<h4 id="orgcf5c999">收件服务器配置</h4>
<div class="outline-text-4" id="text-orgcf5c999">
<p>
我用的是 imap 的协议，如下：
</p>

<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-select-method</span>
<span class="w">      </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">nnimap</span><span class="w"> </span><span class="s">&quot;outlook&quot;</span>
<span class="w">               </span><span class="p">(</span><span class="nv">nnimap-address</span><span class="w"> </span><span class="s">&quot;outlook.office365.com&quot;</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nv">nnimap-server-port</span><span class="w"> </span><span class="mi">993</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nv">nnimap-stream</span><span class="w"> </span><span class="nv">ssl</span><span class="p">)))</span>
 </pre>
</div>
</div>
</div>

<div id="outline-container-org2c15bab" class="outline-4">
<h4 id="org2c15bab">发件服务器配置</h4>
<div class="outline-text-4" id="text-org2c15bab">
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">send-mail-function</span><span class="w"> </span><span class="ss">&#39;smtpmail-send-it</span>
<span class="w">      </span><span class="nv">smtpmail-smtp-server</span><span class="w"> </span><span class="s">&quot;smtp.office365.com&quot;</span>
<span class="w">      </span><span class="nv">smtpmail-smtp-service</span><span class="w"> </span><span class="mi">587</span><span class="p">)</span>
 </pre>
</div>

<p>
不需要配置加密方式。
</p>
</div>
</div>

<div id="outline-container-org79b4755" class="outline-4">
<h4 id="org79b4755">身份验证配置</h4>
<div class="outline-text-4" id="text-org79b4755">
<p>
身份验证信息是写在一个单独文件里，变量 <code>auth-sources</code> 说明了验证文件的位置，默认是 <code>("~/.authinfo" "~/.authinfo.gpg" "~/.netrc")</code>, 你可以根据自己的需要改，或者就写在默认的 <code>~/.authinfo</code> 也行。
</p>

<div class="org-src-container">
<pre class="nil"> machine &amp;lt;server&amp;gt; login &amp;lt;your-email@example.com&amp;gt; password &amp;lt;your password&amp;gt; port &amp;lt;port&amp;gt;
machine &amp;lt;server&amp;gt; login &amp;lt;your-email@example.com&amp;gt; password &amp;lt;your password&amp;gt; port &amp;lt;port&amp;gt;
 </pre>
</div>

<p>
有两条记录，分别是<b>收件服务器</b>和<b>发件服务器</b>的验证。
</p>
<ul class="org-ul">
<li><code>machine</code> 后边写上服务器的地址</li>
<li><code>login</code> 后边跟上你的邮箱地址</li>
<li><code>password</code> 后边是密码</li>
<li><code>port</code> 后边是对应的端口</li>
</ul>

<p>
以前面的信息为例就是：
</p>
<div class="org-src-container">
<pre class="nil"> machine outlook.office365.com login &amp;lt;user&amp;gt;@outlook.com password &amp;lt;password&amp;gt; port 993
machine smtp.office365.com login &amp;lt;user&amp;gt;@outlook.com password &amp;lt;password&amp;gt; port 587
 </pre>
</div>

<p>
可以使用 Emacs 自带的加密系统加密：
</p>
<ol class="org-ol">
<li>新建一个 <code>~/.authinfo.gpg</code></li>
<li>在首行键入 <code>-*- epa-file-encrypt-to: nil -*-</code></li>
<li>输入上面那两行验证条目</li>
<li>保存，然后会要求输入密码</li>
</ol>
</div>
</div>

<div id="outline-container-orgcd126ac" class="outline-4">
<h4 id="orgcd126ac">使用</h4>
<div class="outline-text-4" id="text-orgcd126ac">
<p>
至此，一个简单的邮箱配置就完成了。打开 Emacs, 然后 <code>M-x gnus RET</code> 就可以进入到 GNUS 的界面了。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb51f6be" class="outline-2">
<h2 id="orgb51f6be">GNUS 结构</h2>
<div class="outline-text-2" id="text-orgb51f6be">
<p>
GNUS 有三大部分构成： Server, Group 和 Article. 简单理解：
</p>
<ul class="org-ul">
<li><b>Server</b> 就是一个服务器，每不同的邮箱帐号就对应不同的 Server 。</li>
<li><b>Group</b> 是服务器 Server 下的文件夹</li>
<li><b>Article</b> 是组 Group 下的邮件</li>
</ul>

<p>
其结构如下：
</p>
<div class="org-src-container">
<pre class="mermaid">graph TD;

A[Server:outlook.com] --&gt; B[Group:Inbox]
A --&gt; C[Group:Send]
A --&gt; D[Group:Trush]

B --&gt; B1[Article]
B --&gt; B2[Article]
B --&gt; B3[Article]

C --&gt; C1[Article]
C --&gt; C2[Article]
C --&gt; C3[Article]

D --&gt; D1[Article]
D --&gt; D2[Article]
D --&gt; D3[Article]
</pre>
</div>

<p>
由此也衍生出了不同的 <b>buffer</b> 用于显示不同的信息：
</p>
<ul class="org-ul">
<li><code>*Server*</code>, 服务器列表，用于展示服务器</li>
<li><code>*Group*</code>, 组列表，用于展示服务器下的组</li>
<li><code>*Summary*</code>, 文章列表，用于展示组下的文章</li>
<li><code>*Article*</code> ，文章的具体内容</li>
</ul>
</div>
</div>

<div id="outline-container-org75716e0" class="outline-2">
<h2 id="org75716e0">Group</h2>
<div class="outline-text-2" id="text-org75716e0">
<p>
组列表，展示当前服务器下所有的组。区分订阅（subscript）和可见（visible）。
</p>

<ul class="org-ul">
<li>订阅是告诉 GNUS 那些组需要去获取（fetch）。比如 Outlook, 它内置了很多文件夹如笔记（Notes）、存档、同步等，我删不掉且不会用到，那么我㠇可以取消订阅它 (unsubscribe), 之后就不会去获取这个文件夹的内容了。默认是所有文件夹都订阅的。在一个新帐号刚配置时，会默认订阅该帐号下所有的文件夹。订阅设置接下来就会说到。</li>
<li>可见是指，对于订阅的组，哪些会展示在 Group Buffer 上。默认情况下，有未读邮件的组可见，其它组不可见。但我有点不习惯这个，在<a href="#org43f7e3b">组参数</a>那里会说怎么调。</li>
</ul>
</div>

<div id="outline-container-org0a7baab" class="outline-3">
<h3 id="org0a7baab">组操作</h3>
<div class="outline-text-3" id="text-org0a7baab">
</div>
<div id="outline-container-org7be7768" class="outline-4">
<h4 id="org7be7768">组订阅</h4>
<div class="outline-text-4" id="text-org7be7768">
<ul class="org-ul">
<li>S t （或 u） 订阅开关，如果已经订阅设为不订阅，如果不订阅设为订阅。</li>
<li>S s （或 U） 弹出 minibuffer, 选择一个组，然后使用订阅开关</li>
</ul>

<p>
GNUS 是通过组的一个 level 来判断是否要订阅或者不订阅某个组。所以如果不想订阅，可以在配置里面写：
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-unsubscribed-groups</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Notes&quot;</span>
<span class="w">                                 </span><span class="c1">;; ...</span>
<span class="w">                                 </span><span class="p">))</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">my/gnus-handle-unscribed-groups</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="p">(</span><span class="nb">dolist</span><span class="w"> </span><span class="p">(</span><span class="nv">group</span><span class="w"> </span><span class="nv">gnus-unsubscribed-groups</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">gnus-group-change-level</span><span class="w"> </span><span class="nv">group</span>
<span class="w">                             </span><span class="nv">gnus-level-unsubscribed</span>
<span class="w">                             </span><span class="nv">gnus-level-default-subscribed</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span><span class="w"> </span><span class="ss">&#39;gnus-group-prepare</span><span class="w"> </span><span class="l l-Other">#&quot;&quot;</span><span class="nv">my/gnus-handle-unscribed-groups</span><span class="p">)</span>
 </pre>
</div>

<p>
此时依然可以在 Buffer 里面看到它们，但是会多一个 <code>U</code> 的标志，表示不订阅。
</p>
</div>
</div>

<div id="outline-container-orge9bf0a8" class="outline-4">
<h4 id="orge9bf0a8">组光标移动</h4>
<div class="outline-text-4" id="text-orge9bf0a8">
<ul class="org-ul">
<li>n 移动到下一个含有<b>未读消息</b>的组</li>
<li>p 移动到上一个含有<b>未读消息</b>的组</li>
<li>N 移动到下一个组</li>
<li>P 移动到上一个组</li>
<li>j 选择跳转到一个组，可以输入字符搜索，可以跳转到未显示的组</li>
<li>. 移动到<b>第一个</b>含有<b>未读消息</b>的组</li>
</ul>
</div>
</div>

<div id="outline-container-orgf316883" class="outline-4">
<h4 id="orgf316883">组打开退出</h4>
<div class="outline-text-4" id="text-orgf316883">
<ul class="org-ul">
<li>SPC 打开组，进入 <code>*Summary* buffer</code>, 同时<b>自动打开第一个未读的消息</b>。列表只显示了<b>未读</b>的或者<b>标记</b>了的信息。</li>
<li>RET 打开组，不自动打开消息</li>
<li>q 询问是否缓存并退出 GNUS</li>
</ul>
</div>
</div>

<div id="outline-container-orgcbe36c9" class="outline-4">
<h4 id="orgcbe36c9">组标记</h4>
<div class="outline-text-4" id="text-orgcbe36c9">
<ul class="org-ul">
<li>c 标记当前组内 <b>*没有被标记的文章</b>为已读</li>
<li>C 标记当前组内 <b>*所有文章</b>为已读</li>
<li>M m （或 #） 标记当前组</li>
<li>M u （或 M-#） q 取消标记当前组</li>
<li>M U 取消所有标记</li>
<li>M b 标记当前 buffer 的所有组</li>
</ul>
</div>
</div>

<div id="outline-container-org71d1de1" class="outline-4">
<h4 id="org71d1de1">组管理</h4>
<div class="outline-text-4" id="text-org71d1de1">
<p>
管理组都会向服务器<b>发送请求</b>，比如我要新建一个组，那么就会发请求去服务器那边告诉它这边要新建一个组。如果 Outlook 的回收站名字叫 Junk, 我想重命名它，然后后收到服务器那边的拒绝 -&#x2013;&#x2014; 这个是它默认的文件夹，是不让改的。
</p>

<ul class="org-ul">
<li>G m 添加一个组，会被询问名字、方法（协议）、地址等信息</li>
<li>G r 重命名一个组</li>
<li>G p 编辑组参数</li>
<li>G R 添加一个 RSS 组。不会发送到服务器</li>
<li>G DEL 删除组，字面意义上的删除。如果给了前缀 C-u, 删除包括里面的文章。<b>慎用！！！</b></li>
</ul>
</div>
</div>

<div id="outline-container-orgebe74a7" class="outline-4">
<h4 id="orgebe74a7">组显示</h4>
<div class="outline-text-4" id="text-orgebe74a7">
<p>
组可见是指能不能在 <code>*Group*</code> buffer 中显示，并不是它被删除。默认情况下，如果一个组没有了未读文章就会被隐藏，使得我们的注意力可以集中在那些未处理的消息上。
</p>

<ul class="org-ul">
<li>A s （或 l） 显示含有未读文章的组，默认下只显示等级 5 及以下的组——一般组的等级都是 3</li>
<li>A u （或 L） 显示所有组，不管含不含有未读</li>
<li>A m 显示名字正则匹配且含有未读的组。如果输入空就是还原</li>
<li>A M 显示所有名字正则匹配的组</li>
</ul>
</div>
</div>

<div id="outline-container-org94f03c4" class="outline-4">
<h4 id="org94f03c4">组排序</h4>
<div class="outline-text-4" id="text-org94f03c4">
<ul class="org-ul">
<li>G S a 按<b>名字</b>以字母表顺序排序</li>
<li>G S u 按<b>名字</b>以字母表顺序排序含有未读</li>
<li>G S l 按<b>等级</b>排序</li>
<li>G S v 按<b>分数</b>排序</li>
</ul>
</div>
</div>

<div id="outline-container-org36a1fb2" class="outline-4">
<h4 id="org36a1fb2">组其他操作</h4>
<div class="outline-text-4" id="text-org36a1fb2">
<ul class="org-ul">
<li>^ 打开服务器列表，进入 <code>*Server* buffer</code></li>
<li>a 新建一封信息</li>
<li>g 刷新服务器</li>
<li>R 重启 GNUS</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org43f7e3b" class="outline-3">
<h3 id="org43f7e3b">组参数</h3>
<div class="outline-text-3" id="text-org43f7e3b">
<p>
本质上是一个列表，如：
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">((</span><span class="nv">to-address</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;ding@gnus.org&quot;</span><span class="p">)</span>
<span class="w"> </span><span class="p">(</span><span class="nv">auto-expire</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="no">t</span><span class="p">))</span>
 </pre>
</div>

<p>
每个组都会有一个这样的列表
</p>

<p>
常用参数：
</p>
<ul class="org-ul">
<li><code>visible</code>, 布尔值，如果设为 <code>t</code> ，那么该组一直可见，即使没有未读文章</li>
<li><code>display</code>, 进入该组时，展示的文章数量
<ul class="org-ul">
<li><code>all</code>, 展示所有文章</li>
<li>整数 N, 表示展示最多 N 篇文章</li>
<li><code>default</code>, 展示默认可见的文章，包括未读和标记，过期的不展示</li>
</ul></li>
<li><code>comment</code>, 一段注释，字符串类型，即要加双引号</li>
<li><code>charset</code>, 字符集</li>
</ul>

<p>
组参数可以在配置文件中批量配置，通过设置变量 <code>gnus-parameters</code> 来实现。
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-parameters</span>
<span class="w">      </span><span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;mail\\..*&quot;</span><span class="w"> </span><span class="p">(</span><span class="nv">display</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">all</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="s">&quot;list\\..*&quot;</span>
<span class="w">         </span><span class="p">(</span><span class="nv">total-expire</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="no">t</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="nv">broken-reply-to</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="no">t</span><span class="p">))))</span>
 </pre>
</div>

<p>
第一个参数是用于正则匹配，名字匹配到的组会加上后续的参数。 <code>gnus-parameters-case-fold-search</code> 表明了匹配时是否忽略大小写，默认是忽略。
</p>

<p>
<code>visible</code> 不能通过这种方式设置，有一个变量 <code>gnus-permanently-visible-groups</code> 专门用于设置可见组，它是一个字符串，用于正则匹配的，可以这样配置：
</p>

<div class="org-src-container">
<pre class="elisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-permanently-visible-groups</span>
<span class="w">      </span><span class="p">(</span><span class="nf">string</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;pattern-1&quot;</span>
<span class="w">                </span><span class="s">&quot;pattern-2&quot;</span>
<span class="w">                </span><span class="c1">; ...)</span>
<span class="w">              </span><span class="s">&quot;\\|&quot;</span><span class="p">))</span>
 </pre>
</div>
</div>
</div>

<div id="outline-container-orgc7d0ead" class="outline-3">
<h3 id="orgc7d0ead">话题</h3>
<div class="outline-text-3" id="text-orgc7d0ead">
<p>
话题 Topic, 暂时用不到。
</p>
</div>
</div>
</div>

<div id="outline-container-org8f62147" class="outline-2">
<h2 id="org8f62147">Summary Buffer</h2>
<div class="outline-text-2" id="text-org8f62147">
<p>
文章列表（字面翻译的话就叫“纲要”吧），展示当前组下所有的文章。默认情况下只展示<b>未读文章</b>。
</p>
</div>

<div id="outline-container-org73b5b42" class="outline-3">
<h3 id="org73b5b42">纲要操作</h3>
<div class="outline-text-3" id="text-org73b5b42">
</div>
<div id="outline-container-orgb2388ed" class="outline-4">
<h4 id="orgb2388ed">纲要打开与退出</h4>
<div class="outline-text-4" id="text-orgb2388ed">
<ul class="org-ul">
<li>SPACE/RET 在文章尚未打开时，这两个就是打开文章。如果打开后会变成其它功用</li>
<li>q 退出当前组</li>
<li><p>
c 标记所有未标记的文章为<b>已读</b>，并退出
</p>

<p>
一般用不到，在读完当前组的消息后，再次按翻页或者下一条会自动跳转到下一个有未读消息的组
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgdbd5384" class="outline-4">
<h4 id="orgdbd5384">纲要光标移动</h4>
<div class="outline-text-4" id="text-orgdbd5384">
<ul class="org-ul">
<li>n 移动到下一未读文章</li>
<li>p 移动到上一未读文章</li>
<li>N 移动到下一篇文章</li>
<li>P 移动到上一篇文章</li>
</ul>
</div>
</div>

<div id="outline-container-orgf2a3a1c" class="outline-4">
<h4 id="orgf2a3a1c">文章滚动与操作</h4>
<div class="outline-text-4" id="text-orgf2a3a1c">
<p>
在 <code>*Summary*</code> buffer 下打开文章会弹出一个 <code>*Article*</code> buffer, 但光标依然停留在 <code>*Summary*</code>, 也就是还能用 n/p/N/P 来选择不同文章，文章的 buffer 内容也会跟着相应变化。
</p>

<p>
此时一些键盘映射已经改变，使得光标即使在纲要的 buffer ，也能对文章 buffer 进行翻页操作。
</p>

<ul class="org-ul">
<li>SPACE 向下翻一页，如果已经达到底部，那么再按 SPACE 就会自动跳转到下一篇<b>未读</b>文章</li>
<li>DEL 向上翻一页</li>
<li>RET 向下滚动一行</li>
<li>M-RET 向上回滚一行</li>
<li>&lt; 回到首行</li>
<li>&gt; 移动到底行</li>
<li>g 重新获取（刷新）文章</li>
<li>s 在文章中渐进搜索（ I-search ），使用 <code>C-s</code> 来向前继续搜索， <code>C-r</code> 来向后搜索</li>
<li>h 选择文章，也就是把光标移动到文章的buffer</li>
</ul>
</div>
</div>

<div id="outline-container-orgab6aca2" class="outline-4">
<h4 id="orgab6aca2">文章显示</h4>
<div class="outline-text-4" id="text-orgab6aca2">
<ul class="org-ul">
<li>/ / （或 / s） 展示相同主题（subject）的文章，加前缀 C-u 则是排除该主题</li>
<li>/ a 展示相同作者的文章，加前缀 C-u 则是排除该主题</li>
<li>/ R 展示相同收件人（recipient）的文章，加前缀 C-u 则是排除该主题</li>
<li>/ A 展示 To, From, Cc 有给定地址的文章，加前缀 C-u 则是排除该主题</li>
<li>/ u （或者 x） 展示未读文章，加前缀 C-u 则展示<b>严格未读</b>的，被标记为标记（ticked）和休眠的都会排除</li>
<li>/ m 展示给定标记的文章</li>
<li>/ t 展示给定天数（days）之内的文章，加前缀 C-u 则是给定天数之外</li>
<li>/ r 展示已回复的文章，加前缀 C-u 则是未回复</li>
<li>/ b 展示（搜索）文章<b>内容</b>匹配给定字符的文章，加前缀 C-u 就是排除。可能会很慢</li>
<li>/ h 展示（搜索）文章<b>头部</b>匹配给定字符的文章，加前缀 C-u 就是排除。可能会很慢</li>
</ul>
</div>
</div>

<div id="outline-container-org2662f23" class="outline-4">
<h4 id="org2662f23">邮件操作</h4>
<div class="outline-text-4" id="text-org2662f23">
<ul class="org-ul">
<li>B DEL 删除当前邮件</li>
<li>B m 移动当前邮件</li>
<li>B c 复制当前邮件</li>
</ul>
</div>
</div>

<div id="outline-container-orge97e6ac" class="outline-4">
<h4 id="orge97e6ac">文章搜索</h4>
<div class="outline-text-4" id="text-orge97e6ac">
<ul class="org-ul">
<li>M-s 向后搜索</li>
<li>M-r 向前搜索</li>
<li>M-S 重复向后搜索</li>
<li>M-R 重复向前搜索</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb800371" class="outline-3">
<h3 id="orgb800371">文章发送</h3>
<div class="outline-text-3" id="text-orgb800371">
</div>
<div id="outline-container-orga06b495" class="outline-4">
<h4 id="orga06b495">邮件撰写</h4>
<div class="outline-text-4" id="text-orga06b495">
<ul class="org-ul">
<li>m 准备一封邮件进行撰写。使用默认样式。</li>
<li>S i 准备一则新闻，默认会发送到当前组。</li>
<li>S D b 重新准备<b>未发送成功</b>的邮件。</li>
<li>S D r 重新准备<b>未发送成功</b>的邮件，需要重新指定地址。</li>
<li>S D e 重新准备<b>未发送成功</b>的邮件，需要重新编辑内容。</li>
</ul>
</div>
</div>

<div id="outline-container-orga6c9f75" class="outline-4">
<h4 id="orga6c9f75">文章回复</h4>
<div class="outline-text-4" id="text-orga6c9f75">
<ul class="org-ul">
<li>r 回复当前文章的作者</li>
<li>R 回复当前文章的作者，并附上文章的原始内容</li>
<li>S w 广泛回复，回复给文章中的 To, From 和抄送列表的所有人</li>
<li>S W 广泛回复，并附上文章的原始内容</li>
</ul>
</div>
</div>

<div id="outline-container-org4eff897" class="outline-4">
<h4 id="org4eff897">文章撰写</h4>
<div class="outline-text-4" id="text-org4eff897">
<ul class="org-ul">
<li>S p （或 a） 准备一篇文章，默认发到当前组。</li>
<li>S f （或 f） 发送一篇后续（followup）到当前文章</li>
<li>S F （或 F） 发送一篇后续（followup）到当前文章，并附上当前文章的原始内容</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1b3bcaf" class="outline-3">
<h3 id="org1b3bcaf">文章标记</h3>
<div class="outline-text-3" id="text-org1b3bcaf">
</div>
<div id="outline-container-org7df1fae" class="outline-4">
<h4 id="org7df1fae">文章标记样式</h4>
<div class="outline-text-4" id="text-org7df1fae">
<ul class="org-ul">
<li>'!' <b>标记</b>（ticked），它意味着不管读没读过该文章都<b>一直可见</b>，但是会过期。</li>
<li>'?' <b>休眠</b>，它只有在文章有后续更新时才会显示</li>
<li>'r' <b>已读</b>，不一定真的读了，它是被用户标记为已读状态</li>
<li>'R' <b>真已读</b>，真的被浏览了</li>
<li>'O' <b>过时</b>，之前被标记为已读，但现在已经有更新</li>
<li>'K' <b>删除</b>，被标记的</li>
<li>'X' <b>删除</b>，指文件已经不存在</li>
<li>'C' <b>赶上</b>（catchup）</li>
<li>'G' <b>取消</b></li>
<li>'M' <b>重复</b></li>
<li>'E' <b>过期</b></li>
</ul>
</div>
</div>

<div id="outline-container-org8281363" class="outline-4">
<h4 id="org8281363">文章标记操作</h4>
<div class="outline-text-4" id="text-org8281363">
<ul class="org-ul">
<li>! 标记当前文章为<b>标记</b>（ticked）</li>
<li>? 标记当前文章为<b>休眠</b></li>
<li>M-u 标记当前文章为<b>未读</b></li>
<li>d 标记当前文章为<b>已读</b></li>
<li>D 标记当前文章为<b>已读</b>，光标向上移动一行
<ul class="org-ul">
<li>M C-c 标记<b>所有</b>文章为<b>已读</b></li>
</ul></li>
<li>E 标记当前文章为<b>过期</b></li>
<li>M b 给当前文章设置书签</li>
<li>M B 移除当前文章的所有书签</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org128c85e" class="outline-3">
<h3 id="org128c85e">文章排序</h3>
<div class="outline-text-3" id="text-org128c85e">
<p>
默认文章排序可以通过初始化变量 <code>gnus-article-sort-functions</code>, 它是一个列表，包含了各种排序函数，<b>最后一个函数是主要的排序函数</b>。内置的函数有：
</p>
<ul class="org-ul">
<li>gnus-article-sort-by-number 按序号排序，默认值，建议是第一个</li>
<li>gnus-summary-sort-by-most-recent-number 按最近序号排序</li>
<li>gnus-article-sort-by-author 按作者排序</li>
<li>gnus-summary-sort-by-recipient 按收件人排序</li>
<li>gnus-article-sort-by-subject 按主题排序</li>
<li>gnus-article-sort-by-date 按日期排序</li>
<li>gnus-summary-sort-by-most-recent-date 按最近日期排序</li>
<li>gnus-article-sort-by-score 按分数排序</li>
<li>gnus-summary-sort-by-lines 按文章行数排序</li>
<li>gnus-summary-sort-by-chars 按文章子树排序</li>
<li>gnus-article-sort-by-random 随机排序</li>
</ul>

<p>
我的配置是：
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">gnus-article-sort-functions</span>
<span class="w">      </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">gnus-article-sort-by-number</span>
<span class="w">        </span><span class="nv">gnus-summary-sort-by-most-recent-date</span><span class="p">))</span>
 </pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e7c85a" class="outline-2">
<h2 id="org3e7c85a">Article Buffer</h2>
<div class="outline-text-2" id="text-org3e7c85a">
<p>
文章内容的 buffer, 用于展示文章的内容（废话）。
</p>

<ul class="org-ul">
<li>SPACE 向下滚动一页</li>
<li>DEL 向上滚动一页</li>
<li>C-c C-m 准备一封回信给光标附近的地址</li>
<li>h （或 s） 光标在回到 <code>*Summary*</code> 和 <code>*Article*</code> 间切换</li>
<li>TAB 移动到下一个<b>可点击处</b></li>
<li>M-TAB 移动到上一个可点击处</li>
<li>R 准备一篇回复给当前文章，并附上文章内容。如果选定了区域，只附上选定的内容</li>
<li>S W 准备一篇广回复</li>
<li>F 准备一篇后续</li>
</ul>
</div>
</div>

<div id="outline-container-orgaee4763" class="outline-2">
<h2 id="orgaee4763">信息发送</h2>
<div class="outline-text-2" id="text-orgaee4763">
<p>
在<a href="#orgb800371">文章发送</a>那里写好邮件，通过 <code>C-c C-c</code> 发送最后一封编辑的邮件
</p>
</div>

<div id="outline-container-orgacd3616" class="outline-4">
<h4 id="orgacd3616">定时发送</h4>
<div class="outline-text-4" id="text-orgacd3616">
<p>
需要在配置里面加上：
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="nv">gnus-delay-initialize</span><span class="p">)</span>
 </pre>
</div>
<p>
它会初始化 delay 相关的包，和定制键盘映射。
</p>

<p>
在编辑邮件时 <code>C-c C-j</code> 来定时发送邮件。
</p>

<p>
<b>定时发送</b>可以设置的选项：
</p>
<ul class="org-ul">
<li>一段时间，如“42d”，那么就会在 42 天之后发送。有 m (分钟), h (小时), d (天), w (周), M (月), Y (年) 。</li>
<li>具体日期，格式“YYYY-MM-DD”，然后会在 <code>gnus-delay-default-hour</code> 这个时间点发送，默认是 8:00 am.</li>
<li>具体时间，格式“hh:mm”， 24 小时制。如果当前时间在其之前，那么今天到点就发；否则，明天发。</li>
</ul>

<p>
它会在邮件头上加上一个头 <code>gnus-delay-header</code> ，默认是“X-Gnus-Delayed”，它的值是要发送的日期。
</p>
</div>
</div>

<div id="outline-container-org284a95c" class="outline-4">
<h4 id="org284a95c">草稿</h4>
<div class="outline-text-4" id="text-org284a95c">
<p>
对于一封正在写的信，可以通过 <code>C-x C-s</code> 即 buffer 保存键把其保存到草稿，即 <code>nndraft:drafts</code> 组中，进入之后，可以进行的操作：
</p>
<ul class="org-ul">
<li>D e 编辑该草稿</li>
<li>D s 发送当前草稿</li>
<li>D S 发送所有草稿</li>
<li>D t 开关发送标志</li>
<li>B DEL 删除当前草稿</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9225996" class="outline-2">
<h2 id="org9225996">RSS</h2>
<div class="outline-text-2" id="text-org9225996">
<p>
目前我的做法是在配置文件中维护一份 RSS 列表，在每次启动 GNUS 之后检查，如果没有的话自动添加。
</p>
<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="nb">defvar</span><span class="w"> </span><span class="nv">rss-list</span>
<span class="w">  </span><span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;Emacs China - 最新话题&quot;</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;https://emacs-china.org/latest.rss&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c1">;; ...</span>
<span class="w">    </span><span class="p">))</span>
<span class="c1">;; 原生版本</span>
<span class="p">(</span><span class="nv">add-hook</span><span class="w"> </span><span class="ss">&#39;gnus-group-prepare-hook</span>
<span class="w">          </span><span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">()</span>
<span class="w">              </span><span class="p">(</span><span class="nb">dolist</span><span class="w"> </span><span class="p">(</span><span class="nv">it</span><span class="w"> </span><span class="nv">rss-list</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nv">gnus-group-entry</span><span class="w"> </span><span class="p">(</span><span class="nv">concat</span><span class="w"> </span><span class="s">&quot;nnrss:&quot;</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">it</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">title</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">it</span><span class="p">))</span>
<span class="w">                       </span><span class="p">(</span><span class="nv">href</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">it</span><span class="p">)))</span>
<span class="w">                   </span><span class="p">(</span><span class="nv">gnus-group-make-group</span><span class="w"> </span><span class="nv">title</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">nnrss</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="w">                   </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">title</span><span class="w"> </span><span class="nv">href</span><span class="w"> </span><span class="nv">title</span><span class="p">)</span><span class="w"> </span><span class="nv">nnrss-group-alist</span><span class="p">))))</span>
<span class="w">              </span><span class="p">(</span><span class="nv">nnrss-save-server-data</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span>
<span class="c1">;; dash.el 版本</span>
<span class="p">(</span><span class="nv">add-hook</span><span class="w"> </span><span class="ss">&#39;gnus-group-prepare-hook</span>
<span class="w">          </span><span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">()</span>
<span class="w">              </span><span class="p">(</span><span class="nv">--map-when</span>
<span class="w">               </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nv">gnus-group-entry</span><span class="w"> </span><span class="p">(</span><span class="nv">concat</span><span class="w"> </span><span class="s">&quot;nnrss:&quot;</span>
<span class="w">                                              </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">it</span><span class="p">))))</span>
<span class="w">               </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">title</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">it</span><span class="p">))</span>
<span class="w">                     </span><span class="p">(</span><span class="nv">href</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">it</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">(</span><span class="nv">gnus-group-make-group</span><span class="w"> </span><span class="nv">title</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">nnrss</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="w">                 </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">title</span><span class="w"> </span><span class="nv">href</span><span class="w"> </span><span class="nv">title</span><span class="p">)</span><span class="w"> </span><span class="nv">nnrss-group-alist</span><span class="p">))</span>
<span class="w">               </span><span class="nv">rss-list</span><span class="p">)</span>
<span class="w">              </span><span class="p">(</span><span class="nv">nnrss-save-server-data</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span>
 </pre>
</div>
</div>

<div id="outline-container-org35ae315" class="outline-3">
<h3 id="org35ae315">通过 Feeddd 获取微信公众号</h3>
<div class="outline-text-3" id="text-org35ae315">
<p>
微信公众号自身不提供 RSS, 但是还是有高手做了项目，比如 <a href="https://feeddd.org/" target="_blank">Feeddd</a>. 但是我发现 Feeddd 的 rss 都是只有个标题和一条超链接，点击超链接之后装到微信官方的站点去查看，甚是不便。于是我便根据 Emacs 内置的浏览器 <a href="https://www.gnu.org/software/emacs/manual/html_mono/eww.html" target="_blank">EWW</a> 获取文章内容， EWW 会把文章内容渲染好之后输出到一个 buffer ，再把它覆盖到邮件里——只是改了 buffer 内容，不会真地去改变 rss 原来的内容。
</p>

<p>
但是<b>图片显示不出来</b>。这是 EWW 的问题，因为它不加载 js ——如果图片是 HTML 标签就会加载；如果是通过 js 插入的就不行。而微信属于后者。我觉得懒猫大神的 EAF 应该可以做到。
</p>

<div class="org-src-container">
<pre class="lisp"> <span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">my/gnus--wechat-need-fetch</span><span class="w"> </span><span class="p">(</span><span class="nv">group</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Check the gourp&#39;s uri. GROUP is a string&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">uri</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="p">(</span><span class="nv">assoc-string</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">rss-list</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="nv">uri</span>
<span class="w">         </span><span class="p">(</span><span class="nv">string-match-p</span><span class="w"> </span><span class="s">&quot;api.feedd&quot;</span><span class="w"> </span><span class="nv">uri</span><span class="p">))))</span>
<span class="p">(</span><span class="nb">defvar</span><span class="w"> </span><span class="nv">my/eww--sig</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">my/eww--set-sig</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="s">&quot;Set singal when EWW is loaded.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">my/eww--sig</span><span class="w"> </span><span class="no">t</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">my/gnus-fetch-content-from-wechat</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="err">&quot;</span><span class="nv">Fetch</span><span class="w"> </span><span class="nv">content</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">wechat</span><span class="w"> </span><span class="nv">link</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="k">the</span><span class="w"> </span><span class="nv">posts</span>
<span class="nv">TODO:</span><span class="w"> </span><span class="nv">Images</span><span class="w"> </span><span class="nv">don</span><span class="ss">&#39;t</span><span class="w"> </span><span class="nv">show</span><span class="w"> </span><span class="nv">up,</span><span class="w"> </span><span class="nv">while</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">sites</span><span class="w"> </span><span class="nv">do.</span><span class="err">&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="nv">gnus-article-current</span>
<span class="w">             </span><span class="p">(</span><span class="nv">string-match-p</span><span class="w"> </span><span class="s">&quot;^nnrss&quot;</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">gnus-article-current</span><span class="p">))</span>
<span class="w">             </span><span class="p">(</span><span class="nv">my/gnus--wechat-need-fetch</span><span class="w"> </span><span class="nv">nnrss-group</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">save-excursion</span>
<span class="w">      </span><span class="p">(</span><span class="nv">with-current-buffer</span><span class="w"> </span><span class="nv">gnus-article-buffer</span>
<span class="w">        </span><span class="p">(</span><span class="nv">re-search-forward</span><span class="w"> </span><span class="s">&quot;^link$&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="nv">backward-char</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">uri</span><span class="w"> </span><span class="p">(</span><span class="nv">get-text-property</span><span class="w"> </span><span class="p">(</span><span class="nv">point</span><span class="p">)</span><span class="w"> </span><span class="ss">&#39;shr-url</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="nv">res</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nv">save-excursion</span>
<span class="w">            </span><span class="p">(</span><span class="nv">add-hook</span><span class="w"> </span><span class="ss">&#39;eww-after-render-hook</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">my/eww--set-sig</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">eww</span><span class="w"> </span><span class="nv">uri</span><span class="p">)</span>
<span class="w">            </span><span class="c1">;; 我没找到 EWW 渲染完成的接口</span>
<span class="w">            </span><span class="c1">;; 于是写了个计时器，每秒检查一次，5 秒超时</span>
<span class="w">            </span><span class="p">(</span><span class="nv">with-timeout</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span>
<span class="w">              </span><span class="p">(</span><span class="nv">while</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="nv">my/eww--sig</span><span class="p">)</span>
<span class="w">                </span><span class="p">(</span><span class="nv">sleep-for</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">              </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="p">(</span><span class="nv">buffer-string</span><span class="p">)</span>
<span class="w">                    </span><span class="nv">my/eww--sig</span><span class="w"> </span><span class="no">nil</span><span class="p">))</span>
<span class="w">            </span><span class="p">(</span><span class="nv">remove-hook</span><span class="w"> </span><span class="ss">&#39;eww-after-render-hook</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">my/eww--set-sig</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nv">length&amp;gt</span><span class="c1">; res 0)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">read-only-mode</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">beginning-of-line</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">delete-to-end-of-line</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">insert</span><span class="w"> </span><span class="nv">res</span><span class="p">)</span>
<span class="w">            </span><span class="p">(</span><span class="nv">read-only-mode</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">quit-window</span><span class="p">)))</span>
<span class="c1">;; 添加钩子</span>
<span class="p">(</span><span class="nv">add-hook</span><span class="w"> </span><span class="ss">&#39;gnus-article-prepare-hook</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">my/gnus-fetch-content-from-wechat</span><span class="p">)</span>
 </pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgae0198a" class="outline-2">
<h2 id="orgae0198a">后记</h2>
<div class="outline-text-2" id="text-orgae0198a">
<p>
目前这些操作已经完全满足我的日常使用场景了，如果后续有新的体会或改动的话再更新。
</p>
</div>
</div>
<div id="footnotes">
<hr>
<div class="text-footnotes" role="doc-endnotes">
<ol>
<li id="fn:1">
<p class="footpara">
<a href="https://en.wikipedia.org/wiki/Gnus" target="_blank">Gnus - Wikipedia</a>
<a href="#fnr:1.1" class="footnote-backref" role="doc-backlink">↩︎</a>
</p>
</li>
<li id="fn:2">
<p class="footpara">
<a href="https://blog.csdn.net/luixiao1220/article/details/88532912" target="_blank">emacs之使用gnus读取和发送新浪邮件_luixiao1220的博客-CSDN博客</a>
<a href="#fnr:2.1" class="footnote-backref" role="doc-backlink">↩︎</a>
</p>
</li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<script src="/static/mermaid/mermaid.min.js"></script>
<script>
mermaid.initialize({theme: 'neutral', securityLevel: 'loose'});
</script>
</div>
</div>
<div class="footer">
<center> The End </center></div>
</body>
</html>
